<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Detect Templates in Song Data — detect_template • ASAP</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Detect Templates in Song Data — detect_template"><meta name="description" content="Performs template matching on audio files using correlation-based detection."><meta property="og:description" content="Performs template matching on audio files using correlation-based detection."><meta property="og:image" content="https://lxiao06.github.io/ASAP/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ASAP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Detect Templates in Song Data</h1>

      <div class="d-none name"><code>detect_template.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Performs template matching on audio files using correlation-based detection.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">detect_template</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">detect_template</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">template</span>,</span>
<span>  cor.method <span class="op">=</span> <span class="st">"pearson"</span>,</span>
<span>  save_plot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  plot_dir <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  proximity_window <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'Sap'</span></span>
<span><span class="fu">detect_template</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  day <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  indices <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">template_name</span>,</span>
<span>  threshold <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cores <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cor.method <span class="op">=</span> <span class="st">"pearson"</span>,</span>
<span>  save_plot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  plot_percent <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  proximity_window <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>An object to process, either a file path or SAP object</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to specific methods</p></dd>


<dt id="arg-template">template<a class="anchor" aria-label="anchor" href="#arg-template"></a></dt>
<dd><p>For default method: A template object created by create_template()</p></dd>


<dt id="arg-cor-method">cor.method<a class="anchor" aria-label="anchor" href="#arg-cor-method"></a></dt>
<dd><p>Correlation method ("pearson" or "spearman")</p></dd>


<dt id="arg-save-plot">save_plot<a class="anchor" aria-label="anchor" href="#arg-save-plot"></a></dt>
<dd><p>Whether to save detection plots</p></dd>


<dt id="arg-plot-dir">plot_dir<a class="anchor" aria-label="anchor" href="#arg-plot-dir"></a></dt>
<dd><p>For default method: Directory to save plots</p></dd>


<dt id="arg-proximity-window">proximity_window<a class="anchor" aria-label="anchor" href="#arg-proximity-window"></a></dt>
<dd><p>Time window in seconds to filter nearby detections (NULL to disable filtering).
Only the detection with the highest score within each window is retained.</p></dd>


<dt id="arg-day">day<a class="anchor" aria-label="anchor" href="#arg-day"></a></dt>
<dd><p>For SAP objects: Numeric vector of days to process</p></dd>


<dt id="arg-indices">indices<a class="anchor" aria-label="anchor" href="#arg-indices"></a></dt>
<dd><p>For SAP objects: Numeric vector of indices to process</p></dd>


<dt id="arg-template-name">template_name<a class="anchor" aria-label="anchor" href="#arg-template-name"></a></dt>
<dd><p>For SAP objects: Name of template to use</p></dd>


<dt id="arg-threshold">threshold<a class="anchor" aria-label="anchor" href="#arg-threshold"></a></dt>
<dd><p>For SAP objects: New threshold value</p></dd>


<dt id="arg-cores">cores<a class="anchor" aria-label="anchor" href="#arg-cores"></a></dt>
<dd><p>For SAP objects: Number of cores for parallel processing</p></dd>


<dt id="arg-plot-percent">plot_percent<a class="anchor" aria-label="anchor" href="#arg-plot-percent"></a></dt>
<dd><p>For SAP objects: Percentage of files to plot (default: 10)</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>For SAP objects: Whether to print progress messages</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>For default method: A data frame containing detection results with columns:</p><ul><li><p>filename: Name of the processed file</p></li>
<li><p>time: Time point of detection</p></li>
<li><p>score: Correlation score</p></li>
</ul><p>For SAP objects: Updated SAP object with detection results stored in template_matches</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>For WAV files:</p><ul><li><p>Validates input file and template</p></li>
<li><p>Performs correlation matching</p></li>
<li><p>Finds peaks in correlation scores</p></li>
<li><p>Optionally filters nearby detections (if proximity_window is set)</p></li>
<li><p>Optionally saves detection plots</p></li>
</ul><p>For SAP objects:</p><ul><li><p>Parallel processing support</p></li>
<li><p>Day-specific processing</p></li>
<li><p>Optional threshold adjustment</p></li>
<li><p>Progress tracking and reporting</p></li>
<li><p>Selective plot generation</p></li>
<li><p>Filtering of nearby detections when proximity_window is specified</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="proximity-filtering">Proximity Filtering<a class="anchor" aria-label="anchor" href="#proximity-filtering"></a></h2>


<p>When <code>proximity_window</code> is specified, the function will filter detections that occur
within the specified time window (in seconds). For each group of detections within the window,
only the one with the highest score is kept. This is useful for removing false positive detections.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="create_template.html">create_template</a></code> for creating templates</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Detect template in single WAV file</span></span></span>
<span class="r-in"><span><span class="va">detections</span> <span class="op">&lt;-</span> <span class="fu">detect_template</span><span class="op">(</span><span class="st">"path/to/song.wav"</span>,</span></span>
<span class="r-in"><span>                             template <span class="op">=</span> <span class="va">template_obj</span>,</span></span>
<span class="r-in"><span>                             save_plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Detect template in SAP object</span></span></span>
<span class="r-in"><span><span class="va">sap_obj</span> <span class="op">&lt;-</span> <span class="fu">detect_template</span><span class="op">(</span><span class="va">sap_object</span>,</span></span>
<span class="r-in"><span>                          template_name <span class="op">=</span> <span class="st">"template1"</span>,</span></span>
<span class="r-in"><span>                          day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">40</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                          threshold <span class="op">=</span> <span class="fl">0.7</span>,</span></span>
<span class="r-in"><span>                          cores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Process specific indices with plots</span></span></span>
<span class="r-in"><span><span class="va">sap_obj</span> <span class="op">&lt;-</span> <span class="fu">detect_template</span><span class="op">(</span><span class="va">sap_object</span>,</span></span>
<span class="r-in"><span>                          template_name <span class="op">=</span> <span class="st">"template1"</span>,</span></span>
<span class="r-in"><span>                          indices <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span></span>
<span class="r-in"><span>                          save_plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Filter nearby detections within 0.5 seconds</span></span></span>
<span class="r-in"><span><span class="va">sap_obj</span> <span class="op">&lt;-</span> <span class="fu">detect_template</span><span class="op">(</span><span class="va">sap_object</span>,</span></span>
<span class="r-in"><span>                          template_name <span class="op">=</span> <span class="st">"template1"</span>,</span></span>
<span class="r-in"><span>                          proximity_window <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lei Xiao.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

