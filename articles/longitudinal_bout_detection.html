<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Longitudinal Bout Detection • ASAP</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Longitudinal Bout Detection">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ASAP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Longitudinal Bout Detection</h1>
            
      

      <div class="d-none name"><code>longitudinal_bout_detection.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette demonstrates how to detect and analyze song bouts
across <strong>longitudinal recordings</strong> using SAP objects. Bout
detection identifies continuous periods of vocalization, which is
essential for understanding song production patterns during
development.</p>
<p><strong>Prerequisites</strong>: Before reading this vignette, we
recommend completing:</p>
<ul>
<li>
<a href="single_wav_analysis.html">Overview: Basic Audio
Analysis</a> - Core ASAP functions</li>
<li>
<a href="construct_sap_object.html">Constructing SAP Object</a> -
SAP object creation</li>
<li>
<a href="longitudinal_motif_detection.html">Longitudinal Motif
Detection</a> - Motif-based workflow</li>
</ul>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p><strong>What are bouts?</strong> Song bouts are continuous periods of
vocalization separated by silence. In zebra finches, a bout typically
contains multiple motif renditions and provides important context for
understanding song structure and production.</p>
<p><strong>Why detect bouts?</strong> Bout-level analysis enables:</p>
<ul>
<li>Tracking song production rate across development</li>
<li>Analyzing bout duration and structure changes</li>
<li>Understanding motif density within bouts</li>
<li>Identifying practice patterns and song maturation</li>
</ul>
<p><strong>Relationship to motif detection</strong>: While motif
detection identifies specific, repeatable vocal sequences, bout
detection captures the broader temporal structure of vocalization. When
used together (with <code>summary = TRUE</code>), you can analyze how
motifs are organized within bouts across developmental time points.</p>
</div>
<div class="section level2">
<h2 id="complete-pipeline">Complete Pipeline<a class="anchor" aria-label="anchor" href="#complete-pipeline"></a>
</h2>
<p>The bout detection workflow processes all recordings in a SAP object
to identify bouts across multiple time points.</p>
<div class="section level3">
<h3 id="option-1-load-sap-object-from-previous-analysis">Option 1: Load SAP Object from Previous Analysis<a class="anchor" aria-label="anchor" href="#option-1-load-sap-object-from-previous-analysis"></a>
</h3>
<p>If you’ve already completed motif detection (see <a href="longitudinal_motif_detection.html">Longitudinal Motif
Detection</a>), you can load that SAP object and add bout detection:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lxiao06.github.io/ASAP/">ASAP</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load SAP object from previous motif detection vignette</span></span>
<span><span class="va">sap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"longitudinal_motif_analysis.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add bout detection with motif-bout relationships</span></span>
<span><span class="va">sap</span> <span class="op">&lt;-</span> <span class="va">sap</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/find_bout.html">find_bout</a></span><span class="op">(</span></span>
<span>    rms_threshold <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>    min_duration <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>    gap_duration <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>    freq_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>    summary <span class="op">=</span> <span class="cn">TRUE</span>  <span class="co"># Include motif-bout relationships</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize results</span></span>
<span><span class="fu"><a href="../reference/plot_heatmap.html">plot_heatmap</a></span><span class="op">(</span><span class="va">sap</span>, segment_type <span class="op">=</span> <span class="st">"bouts"</span>, balanced <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="option-2-create-new-sap-object">Option 2: Create New SAP Object<a class="anchor" aria-label="anchor" href="#option-2-create-new-sap-object"></a>
</h3>
<p>Alternatively, you can create a new SAP object from scratch (see <a href="construct_sap_object.html">Constructing SAP Object</a> for
detailed instructions):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lxiao06.github.io/ASAP/">ASAP</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create SAP object</span></span>
<span><span class="va">sap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_sap_object.html">create_sap_object</a></span><span class="op">(</span></span>
<span>  base_path <span class="op">=</span> <span class="st">"/path/to/recordings"</span>,</span>
<span>  subfolders_to_include <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"190"</span>, <span class="st">"201"</span>, <span class="st">"203"</span><span class="op">)</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BL"</span>, <span class="st">"Post"</span>, <span class="st">"Rec"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Detect bouts across all recordings</span></span>
<span><span class="va">sap</span> <span class="op">&lt;-</span> <span class="va">sap</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/find_bout.html">find_bout</a></span><span class="op">(</span></span>
<span>    rms_threshold <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>    min_duration <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>    gap_duration <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>    freq_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><strong>Note</strong>: When creating a new SAP object without prior
motif detection, <code>summary = TRUE</code> will not add motif-bout
relationship columns (n_motifs, align_time, etc.). Additionally, because
template matching is not performed, it is possible to detect false
positives such as innate vocalizations or background noise.</p>
</div>
<div class="section level3">
<h3 id="understanding-sap-object-behavior">Understanding SAP Object Behavior<a class="anchor" aria-label="anchor" href="#understanding-sap-object-behavior"></a>
</h3>
<p>The <code><a href="../reference/find_bout.html">find_bout()</a></code> function processes recordings based on
the SAP object’s metadata:</p>
<ul>
<li>
<strong>Lazy loading</strong>: Audio files are read on-demand during
processing</li>
<li>
<strong>Centralized storage</strong>: Results are stored in
<code>sap$bouts</code>
</li>
<li>
<strong>Optional visualizations</strong>: Set
<code>save_plot = TRUE</code> to save detection plots</li>
<li>
<strong>Parallel processing</strong>: Uses multiple cores for
efficient batch processing</li>
</ul>
</div>
<div class="section level3">
<h3 id="example-output">Example Output<a class="anchor" aria-label="anchor" href="#example-output"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View bout detection summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sap</span><span class="op">$</span><span class="va">bouts</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Example output:</span></span>
<span><span class="co">#   filename        day_post_hatch label selec start_time end_time n_motifs</span></span>
<span><span class="co">#   S237_190_1.wav  190           BL    1     2.45       8.32     12</span></span>
<span><span class="co">#   S237_190_1.wav  190           BL    2     15.67      19.84    8</span></span>
<span><span class="co">#   S237_201_1.wav  201           Post  1     3.21       10.45    15</span></span></code></pre></div>
<p>When <code>summary = TRUE</code> is enabled with existing motif data,
additional columns are included:</p>
<ul>
<li>
<code>n_motifs</code>: Number of motifs detected within each
bout</li>
<li>
<code>align_time</code>: Time of first motif (useful for
alignment)</li>
<li>
<code>bout_number_day</code>: Sequential bout number within each
day</li>
<li>
<code>bout_gap</code>: Time interval from previous bout (within same
file)</li>
</ul>
</div>
<div class="section level3">
<h3 id="optional-saving-sap-object">(Optional) Saving SAP Object<a class="anchor" aria-label="anchor" href="#optional-saving-sap-object"></a>
</h3>
<p>After completing bout detection, you can save the SAP object for
later use:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Save the SAP object with bout detection results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">sap</span>, <span class="st">"longitudinal_bout_analysis.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Later, load it back</span></span>
<span><span class="va">sap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"longitudinal_bout_analysis.rds"</span><span class="op">)</span></span></code></pre></div>
<p><strong>What gets saved:</strong> - All metadata and file references
- Bout detection results - Motif data (if previously detected) - All
spectral features and analysis results</p>
<p><strong>Important notes:</strong> - The original WAV files are
<strong>not</strong> included in the saved object - You must keep the
WAV files at their original paths to run additional analyses - The saved
<code>.rds</code> file is typically much smaller than the audio data</p>
</div>
</div>
<div class="section level2">
<h2 id="visualizing-results">Visualizing Results<a class="anchor" aria-label="anchor" href="#visualizing-results"></a>
</h2>
<div class="section level3">
<h3 id="bout-spectrograms">Bout Spectrograms<a class="anchor" aria-label="anchor" href="#bout-spectrograms"></a>
</h3>
<p>Visualize sample bouts from each time point to verify detection
quality:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize 3 random bouts per time point</span></span>
<span><span class="fu"><a href="../reference/visualize_segments.html">visualize_segments</a></span><span class="op">(</span><span class="va">sap</span>, segment_type <span class="op">=</span> <span class="st">"bouts"</span>, n_samples <span class="op">=</span> <span class="fl">3</span>, by_column <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/longitudinal_bout_segments.png" style="width:100.0%" alt="Sample Bouts Across Time Points"><div class="figcaption">Sample Bouts Across Time Points</div>
</div>
</div>
<div class="section level3">
<h3 id="amplitude-envelope-heatmap">Amplitude Envelope Heatmap<a class="anchor" aria-label="anchor" href="#amplitude-envelope-heatmap"></a>
</h3>
<p>Amplitude envelope heatmaps visualize the temporal structure of
detected bouts across song developmental stages.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create amplitude envelope heatmap with balanced sampling</span></span>
<span><span class="fu"><a href="../reference/plot_heatmap.html">plot_heatmap</a></span><span class="op">(</span><span class="va">sap</span>, segment_type <span class="op">=</span> <span class="st">"bouts"</span>, balanced <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/longitudinal_bout_heatmap.png" style="width:100.0%" alt="Bout Amplitude Envelope Heatmap"><div class="figcaption">Bout Amplitude Envelope Heatmap</div>
</div>
<p><strong>The <code>balanced</code> argument</strong> ensures equal
representation across time points (e.g., same number of bouts from each
developmental stage), which improves statistical comparisons of bout
structure across development.</p>
</div>
</div>
<div class="section level2">
<h2 id="bout-summary-statistics">Bout Summary Statistics<a class="anchor" aria-label="anchor" href="#bout-summary-statistics"></a>
</h2>
<div class="section level3">
<h3 id="understanding-summary-metrics">Understanding Summary Metrics<a class="anchor" aria-label="anchor" href="#understanding-summary-metrics"></a>
</h3>
<p>When <code>summary = TRUE</code> is enabled and motif data exists,
<code><a href="../reference/find_bout.html">find_bout()</a></code> calculates additional metrics that reveal the
relationship between bouts and motifs.</p>
<p><strong>Example bout summary table</strong> (showing first 10
bouts):</p>
<div class="float">
<img src="figures/bout_summary_table.png" style="width:100.0%" alt="Bout Summary Statistics Table"><div class="figcaption">Bout Summary Statistics Table</div>
</div>
<p>The table includes all detected bouts with the following columns:</p>
<ul>
<li>
<strong><code>n_motifs</code></strong>: Count of motifs within each
bout
<ul>
<li>Reveals motif density and bout complexity</li>
<li>Typically increases during song development</li>
</ul>
</li>
<li>
<strong><code>align_time</code></strong>: Timestamp of first motif
in bout
<ul>
<li>Useful for aligning bouts across recordings</li>
<li>Enables time-locked analysis of bout structure</li>
</ul>
</li>
<li>
<strong><code>bout_number_day</code></strong>: Sequential bout
number within each day
<ul>
<li>Tracks bout order within recording sessions</li>
<li>Useful for analyzing practice patterns</li>
</ul>
</li>
<li>
<strong><code>bout_gap</code></strong>: Time interval from previous
bout
<ul>
<li>Measures inter-bout intervals</li>
<li>Reveals temporal patterns in song production</li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="interpreting-developmental-changes">Interpreting Developmental Changes<a class="anchor" aria-label="anchor" href="#interpreting-developmental-changes"></a>
</h3>
<p>Bout statistics can reveal important developmental patterns. The
plots below show three key bout metrics across developmental stages:</p>
<div class="float">
<img src="figures/bout_developmental_trends.png" style="width:100.0%" alt="Developmental Trends in Bout Structure"><div class="figcaption">Developmental Trends in Bout Structure</div>
</div>
<p><strong>Understanding the visualization</strong>:</p>
<ul>
<li>
<strong>Boxplots</strong> (colored boxes and whiskers):
<ul>
<li>
<strong>Box</strong>: Middle 50% of data (interquartile range,
IQR)</li>
<li>
<strong>Line in box</strong>: Median value</li>
<li>
<strong>Whiskers</strong>: Extend to 1.5× IQR or min/max values</li>
<li>
<strong>Small dots</strong>: Individual outliers beyond
whiskers</li>
</ul>
</li>
<li>
<strong>Red diamonds with error bars</strong>:
<ul>
<li>
<strong>Diamond</strong>: Mean (average) value</li>
<li>
<strong>Error bars</strong>: Standard error of the mean (SEM =
SD/√n)</li>
</ul>
</li>
<li>
<strong>Significance brackets</strong> (if present):
<ul>
<li>Lines above boxes show significant pairwise differences</li>
<li>
<code>*</code> p &lt; 0.05, <code>**</code> p &lt; 0.01,
<code>***</code> p &lt; 0.001</li>
</ul>
</li>
</ul>
<p><strong>Statistical Analysis</strong>:</p>
<p>Non-parametric testing is used because temporal birdsong metrics
often show skewed distributions and non-constant variance across
development:</p>
<ul>
<li>
<strong>Kruskal-Wallis Test</strong>: An overall test to determine
if significant differences exist across the three stages
(<strong>BL</strong>, <strong>Post</strong>, <strong>Rec</strong>).</li>
<li>
<strong>Pairwise Wilcoxon Tests</strong>: Post-hoc comparisons to
identify specific differences between pairs of stages (e.g., comparing
Baseline to Recovery).</li>
<li>
<strong>Bonferroni Correction</strong>: Applied to p-values to
adjust for multiple comparisons and prevent false discoveries.</li>
<li>
<strong>Significance Markers</strong>: Brackets and stars
(<code>*</code>) in the plot indicate significant pairwise differences
based on these adjusted p-values.</li>
</ul>
<p><strong>Summary of Vocal Bout Changes</strong>: - Bouts become
progressively shorter and contain fewer motifs from BL to Post to Rec. -
The timing between bouts remains unchanged across stages.</p>
</div>
</div>
<div class="section level2">
<h2 id="key-parameters-for-bout-detection">Key Parameters for Bout Detection<a class="anchor" aria-label="anchor" href="#key-parameters-for-bout-detection"></a>
</h2>
<p>Understanding and optimizing these parameters is crucial for accurate
bout detection:</p>
<table class="table">
<colgroup>
<col width="21%">
<col width="25%">
<col width="17%">
<col width="36%">
</colgroup>
<thead><tr class="header">
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
<th>Optimization Tips</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>rms_threshold</code></td>
<td>Amplitude threshold for bout detection</td>
<td>0.1</td>
<td>
<strong>Lower</strong> = more sensitive (detects quieter
bouts)<br><strong>Higher</strong> = more selective (only loud
bouts)<br>Adjust based on recording quality and background noise</td>
</tr>
<tr class="even">
<td><code>min_duration</code></td>
<td>Minimum bout duration (seconds)</td>
<td>0.5</td>
<td>Filter out brief vocalizations<br>Typical range: 0.4-0.7s<br>Shorter
for juvenile birds, longer for adults</td>
</tr>
<tr class="odd">
<td><code>gap_duration</code></td>
<td>Minimum silence between bouts (seconds)</td>
<td>0.3</td>
<td>Defines bout boundaries<br>Typical: 0.3s<br>Longer gaps = fewer,
longer bouts</td>
</tr>
<tr class="even">
<td><code>freq_range</code></td>
<td>Bandpass filter range (kHz)</td>
<td>c(3, 5)</td>
<td>Focus on vocalization frequencies<br>Zebra finch: c(2, 8) or c(3,
5)<br>Adjust for species-specific frequencies</td>
</tr>
<tr class="odd">
<td><code>edge_window</code></td>
<td>Time window for edge effects (seconds)</td>
<td>0.05</td>
<td>Handles recording start artifacts<br>Rarely needs adjustment</td>
</tr>
<tr class="even">
<td><code>norm_method</code></td>
<td>RMS normalization method</td>
<td>“quantile”</td>
<td>“quantile” = robust to outliers<br>“max” = sensitive to peaks</td>
</tr>
<tr class="odd">
<td><code>summary</code></td>
<td>Include motif-bout statistics</td>
<td>FALSE</td>
<td>Set TRUE when motif data exists<br>Adds n_motifs, align_time,
bout_gap</td>
</tr>
<tr class="even">
<td><code>balanced</code></td>
<td>Balance samples across time points</td>
<td>FALSE</td>
<td>Use TRUE for statistical comparisons<br>Ensures equal
representation</td>
</tr>
<tr class="odd">
<td><code>save_plot</code></td>
<td>Save detection visualizations</td>
<td>FALSE</td>
<td>Set TRUE to review detection quality<br>Plots saved to
base_path/plots/bout_detection/</td>
</tr>
<tr class="even">
<td><code>plot_percent</code></td>
<td>Percentage of files to plot</td>
<td>10</td>
<td>When save_plot = TRUE<br>10% provides good sampling</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="tips-for-longitudinal-bout-analysis">Tips for Longitudinal Bout Analysis<a class="anchor" aria-label="anchor" href="#tips-for-longitudinal-bout-analysis"></a>
</h2>
<div class="section level3">
<h3 id="optimize-parameters-first">1. Optimize Parameters First<a class="anchor" aria-label="anchor" href="#optimize-parameters-first"></a>
</h3>
<p>Test parameters on representative files from each time point before
processing the entire dataset:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Test on a single file</span></span>
<span><span class="va">test_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">sap</span><span class="op">$</span><span class="va">base_path</span>, <span class="st">"190"</span>, <span class="va">sap</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">filename</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Try different thresholds</span></span>
<span><span class="va">bouts_low</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_bout.html">find_bout</a></span><span class="op">(</span><span class="va">test_file</span>, rms_threshold <span class="op">=</span> <span class="fl">0.05</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">bouts_med</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_bout.html">find_bout</a></span><span class="op">(</span><span class="va">test_file</span>, rms_threshold <span class="op">=</span> <span class="fl">0.1</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">bouts_high</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_bout.html">find_bout</a></span><span class="op">(</span><span class="va">test_file</span>, rms_threshold <span class="op">=</span> <span class="fl">0.15</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Low threshold:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bouts_low</span><span class="op">)</span>, <span class="st">"bouts\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Medium threshold:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bouts_med</span><span class="op">)</span>, <span class="st">"bouts\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"High threshold:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bouts_high</span><span class="op">)</span>, <span class="st">"bouts\n"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="check-detection-quality">2. Check Detection Quality<a class="anchor" aria-label="anchor" href="#check-detection-quality"></a>
</h3>
<p>Always visualize sample detections to verify bout boundaries are
accurate:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Save plots for manual review</span></span>
<span><span class="va">sap</span> <span class="op">&lt;-</span> <span class="va">sap</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/find_bout.html">find_bout</a></span><span class="op">(</span></span>
<span>    min_duration <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>    save_plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    plot_percent <span class="op">=</span> <span class="fl">20</span>  <span class="co"># Review 20% of files</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Check plots in: base_path/plots/bout_detection/</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="use-summary-statistics">3. Use Summary Statistics<a class="anchor" aria-label="anchor" href="#use-summary-statistics"></a>
</h3>
<p>Enable <code>summary = TRUE</code> when you have motif data to
understand bout-motif relationships:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Requires existing motif detection</span></span>
<span><span class="va">sap</span> <span class="op">&lt;-</span> <span class="va">sap</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/find_motif.html">find_motif</a></span><span class="op">(</span>template_name <span class="op">=</span> <span class="st">"d"</span>, pre_time <span class="op">=</span> <span class="fl">0.7</span>, lag_time <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/find_bout.html">find_bout</a></span><span class="op">(</span>min_duration <span class="op">=</span> <span class="fl">0.4</span>, summary <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now you can analyze motif density in bouts</span></span>
<span><span class="va">sap</span><span class="op">$</span><span class="va">bouts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">label</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>avg_motifs_per_bout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">n_motifs</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="balance-sampling-for-comparisons">4. Balance Sampling for Comparisons<a class="anchor" aria-label="anchor" href="#balance-sampling-for-comparisons"></a>
</h3>
<p>Use <code>balanced = TRUE</code> when creating visualizations or
statistics for cross-timepoint comparisons:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Balanced heatmap for fair comparison</span></span>
<span><span class="va">sap</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/plot_heatmap.html">plot_heatmap</a></span><span class="op">(</span>segment_type <span class="op">=</span> <span class="st">"bouts"</span>, balanced <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Balanced sampling for analysis</span></span>
<span><span class="va">balanced_bouts</span> <span class="op">&lt;-</span> <span class="fu">select_segments</span><span class="op">(</span></span>
<span>  <span class="va">sap</span><span class="op">$</span><span class="va">bouts</span>,</span>
<span>  balanced <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="consider-recording-quality">5. Consider Recording Quality<a class="anchor" aria-label="anchor" href="#consider-recording-quality"></a>
</h3>
<p>Adjust parameters based on recording conditions:</p>
<ul>
<li>
<strong>High background noise</strong>: Increase
<code>rms_threshold</code>, adjust <code>freq_range</code>
</li>
<li>
<strong>Variable amplitude</strong>: Use
<code>norm_method = "quantile"</code>
</li>
<li>
<strong>Short recordings</strong>: Decrease
<code>min_duration</code> to capture all bouts</li>
<li>
<strong>Continuous singing</strong>: Increase
<code>gap_duration</code> to separate bouts</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.2 (2025-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 24.04.3 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] digest_0.6.39     desc_1.4.3        R6_2.6.1          fastmap_1.2.0    </span></span>
<span><span class="co">#&gt;  [5] xfun_0.56         cachem_1.1.0      knitr_1.51        htmltools_0.5.9  </span></span>
<span><span class="co">#&gt;  [9] rmarkdown_2.30    lifecycle_1.0.5   cli_3.6.5         sass_0.4.10      </span></span>
<span><span class="co">#&gt; [13] pkgdown_2.2.0     textshaping_1.0.4 jquerylib_0.1.4   systemfonts_1.3.1</span></span>
<span><span class="co">#&gt; [17] compiler_4.5.2    tools_4.5.2       ragg_1.5.0        evaluate_1.0.5   </span></span>
<span><span class="co">#&gt; [21] bslib_0.10.0      yaml_2.3.12       jsonlite_2.0.0    rlang_1.1.7      </span></span>
<span><span class="co">#&gt; [25] fs_1.6.6</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lei Xiao.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
