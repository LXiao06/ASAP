---
title: "Constructing SAP Objects"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Constructing SAP Objects}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 10,
  fig.height = 5,
  out.width = "100%"
)
```

## Introduction

This vignette demonstrates how to construct and organize **SAP (Song Analysis Pipeline) objects** for longitudinal analysis of zebra finch vocalizations. SAP objects serve as the central data structure in ASAP, managing recordings across multiple developmental time points.
  
**Prerequisites**: Before reading this vignette, we recommend completing:

- [Overview: Basic Audio Analysis](single_wav_analysis.html) - Core ASAP functions
- [Motif Detection](motif_detection.html) - Template optimization workflow

## Organizing Your Recording Data

ASAP expects recordings to be organized in a specific folder structure:

```
base_path/
├── day_post_hatch_1/     # e.g., "190" for 190 dph
│   ├── song_001.wav
│   ├── song_002.wav
│   └── ...
├── day_post_hatch_2/     # e.g., "201" for 201 dph
│   ├── song_001.wav
│   └── ...
└── day_post_hatch_3/     # e.g., "203" for 203 dph
    ├── song_001.wav
    └── ...
```

Each subfolder represents a developmental time point (days post hatch).

## Creating a SAP Object

```{r create-sap, eval = FALSE}
library(ASAP)

# Create SAP object from organized recording folders
sap <- create_sap_object(
  base_path = "/path/to/recordings",
  subfolders_to_include = c("190", "201", "203"),
  labels = c("Baseline", "Post", "Recovery")
)

# View the structure
print(sap)
summary(sap)
```

**Example output:**

```{r sap-print-output, echo = FALSE, eval = TRUE, comment = ""}
cat("SAP Object
===========
Base path: /path/to/recordings
Time points: 3 (190, 201, 203)
Labels: Baseline, Post, Recovery
Total files: 847
  - 190 (Baseline): 312 files
  - 201 (Post): 285 files
  - 203 (Recovery): 250 files")
```

### Key Arguments

| Argument | Description |
|----------|-------------|
| `base_path` | Root directory containing recording folders |
| `subfolders_to_include` | Vector of folder names (typically days post hatch) |
| `labels` | Human-readable labels for each time point |

## Exploring SAP Object Contents

```{r explore-sap, eval = FALSE}
# View metadata
head(sap$metadata)

# Check number of files per time point
table(sap$metadata$label)

# Visualize sample recordings
visualize_song(sap, n_samples = 4, random = TRUE)
```

```{r visualize-sap-output, echo = FALSE, eval = TRUE, out.width = "100%", fig.cap = "Sample spectrograms from SAP object across time points."}
# Placeholder for pre-computed image
# To add: save image from R session and place in vignettes/figures/
if (file.exists("figures/sap_visualize_song.png")) {
  knitr::include_graphics("figures/sap_visualize_song.png")
} else {
  message("Image placeholder: figures/sap_visualize_song.png")
}
```

## SAP Object Structure

A SAP object contains:

| Component | Description |
|-----------|-------------|
| `$base_path` | Root directory path |
| `$metadata` | Data frame with file information |
| `$templates` | Template storage (after `create_template()`) |
| `$motifs` | Detected motifs (after `find_motif()`) |
| `$bouts` | Detected bouts (after `find_bout()`) |
| `$features` | Extracted features (after `analyze_spectral()`) |

## Next Steps

Once you have created a SAP object, proceed to:

- [Longitudinal Motif Detection](longitudinal_motif_detection.html) - Apply templates across all recordings

## Session Info

```{r session-info}
sessionInfo()
```
